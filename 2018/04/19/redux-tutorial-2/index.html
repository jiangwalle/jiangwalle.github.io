<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>redux入门教程(二) ~ React-Redux | WALL-E</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="上一篇博客中,我们介绍的redux库的基本用法，一个component要和redux交互基本分为这么几步：1234将redux的store对象通过props传入到组件中。组件内调用store.dispath(action)发送action到store。组件内调用store.subscribe(listner)向store注册监听函数，一旦state发生变化，store会调用listner函数。li">
<meta name="keywords" content="react,tutorial,redux">
<meta property="og:type" content="article">
<meta property="og:title" content="redux入门教程(二) ~ React-Redux">
<meta property="og:url" content="http://yoursite.com/2018/04/19/redux-tutorial-2/index.html">
<meta property="og:site_name" content="WALL-E">
<meta property="og:description" content="上一篇博客中,我们介绍的redux库的基本用法，一个component要和redux交互基本分为这么几步：1234将redux的store对象通过props传入到组件中。组件内调用store.dispath(action)发送action到store。组件内调用store.subscribe(listner)向store注册监听函数，一旦state发生变化，store会调用listner函数。li">
<meta property="og:image" content="http://yoursite.com/2018/04/19/redux-tutorial-2/sleepy-puppy.gif">
<meta property="og:image" content="http://yoursite.com/2018/04/19/redux-tutorial-2/todo-list-marked.png">
<meta property="og:updated_time" content="2018-04-20T23:25:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redux入门教程(二) ~ React-Redux">
<meta name="twitter:description" content="上一篇博客中,我们介绍的redux库的基本用法，一个component要和redux交互基本分为这么几步：1234将redux的store对象通过props传入到组件中。组件内调用store.dispath(action)发送action到store。组件内调用store.subscribe(listner)向store注册监听函数，一旦state发生变化，store会调用listner函数。li">
<meta name="twitter:image" content="http://yoursite.com/2018/04/19/redux-tutorial-2/sleepy-puppy.gif">
  
    <link rel="alternate" href="/atom.xml" title="WALL-E" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">WALL-E</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">机器人瓦力的网络日志</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-redux-tutorial-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/19/redux-tutorial-2/" class="article-date">
  <time datetime="2018-04-19T10:18:17.000Z" itemprop="datePublished">2018-04-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/随笔/">随笔</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      redux入门教程(二) ~ React-Redux
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>上一篇博客中,我们介绍的redux库的基本用法，一个component要和redux交互基本分为这么几步：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">将redux的store对象通过props传入到组件中。</span><br><span class="line">组件内调用store.dispath(action)发送action到store。</span><br><span class="line">组件内调用store.subscribe(listner)向store注册监听函数，一旦state发生变化，store会调用listner函数。</span><br><span class="line">listner中调用store.getState，并从中取出相关联的state信息，然后调用render重新渲染组件。</span><br></pre></td></tr></table></figure></p>
<p>这里有几个问题：</p>
<ul>
<li>每一个包含state的组件都需要传入store对象，调用store的API来发送action和注册监听函数，比较繁琐。</li>
<li>store.getState拿到的是整个state树，还要从中找到跟组件相关的状态信息。</li>
<li>没有规则说明哪些component去和redux进行交互，如果每一个要，那么组件就会跟redux产生依赖，不利于重用，测试也更复杂。<br><img src="sleepy-puppy.gif" alt=""></li>
</ul>
<p>因此，redux的作者分装了一个React专用的库<a href="https://github.com/reactjs/react-redux" target="_blank" rel="noopener">React-Redux</a>以方便在React中使用Redux。它主要有如下两个特性：</p>
<ul>
<li>自动将component注册到store，并将store中的state转换成props传入到组件中。</li>
<li>定义了组件拆分的规范，将组件划分为容器组件和UI组件。</li>
</ul>
<p>当然使用工具库是一把双刃剑，在便利的同时，也引入了更多的约束。同时，个人觉得React-Redux的API在设计上对初学者不是很友好。使react的学习曲线更加曲折。</p>
<h1 id="组件拆分"><a href="#组件拆分" class="headerlink" title="组件拆分"></a>组件拆分</h1><p>组件拆分的规范是React-Redux的特点之一，它将组件分为两大类容器组件(container component)和UI组件(presentational component)。</p>
<h2 id="UI组件-representational-component"><a href="#UI组件-representational-component" class="headerlink" title="UI组件 (representational component)"></a>UI组件 (representational component)</h2><p>UI组件有如下特征：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">只负责 UI 的呈现，不带有任何业务逻辑</span><br><span class="line">没有状态（即不使用this.state这个变量）</span><br><span class="line">所有数据都由参数（this.props）提供</span><br><span class="line">不使用任何 Redux 的 API</span><br><span class="line">高可复用性</span><br></pre></td></tr></table></figure></p>
<p>下面是一个UI组件的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const Popup = props =&gt; </span><br><span class="line">	&lt;p&gt;&#123;props.text&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure></p>
<p>UI组件的参数全部来源于外部props的输入，所以，像纯函数一样，完全由参数来觉得组件呈现的状态。</p>
<h2 id="容器组件-container-component"><a href="#容器组件-container-component" class="headerlink" title="容器组件(container component)"></a>容器组件(container component)</h2><p>容器组件的特征恰恰相反。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">负责管理数据和业务逻辑，不负责 UI 的呈现</span><br><span class="line">带有内部状态</span><br><span class="line">使用 Redux 的 API</span><br><span class="line">与Redux耦合，不具有复用性</span><br></pre></td></tr></table></figure></p>
<p>简而言之，跟UI呈现相关联的放到UI组件中，以提高复用性，跟数据管理和逻辑相关的，放到容器组件中。一般来说，我们会根据页面来划分组件，一个页面可以创建一个相应的容器组件，在容器组件中组合多个UI组件。</p>
<h1 id="API函数"><a href="#API函数" class="headerlink" title="API函数"></a>API函数</h1><h2 id="connect"><a href="#connect" class="headerlink" title="connect()"></a>connect()</h2><p>React-Redux提供<code>connect</code>函数，用来将组件连接到Redux的Store。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;</span><br><span class="line">const VisibleTodoList = connect()(TodoList);</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，TodoList是 UI 组件，VisibleTodoList就是由 React-Redux 通过connect方法自动生成的容器组件。<br>但是，因为没有定义业务逻辑，上面这个容器组件毫无意义，只是 UI 组件的一个单纯的包装层。为了定义业务逻辑，需要给出下面两方面的信息。</p>
<ul>
<li>输入逻辑：外部的数据（即state对象）如何转换为 UI 组件的参数</li>
<li>输出逻辑：用户发出的动作如何变为 Action 对象，从 UI 组件传出去。</li>
</ul>
<p>因此，connect方法的完整 API 如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;</span><br><span class="line"></span><br><span class="line">const VisibleTodoList = connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(TodoList)</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，connect方法接受两个参数：mapStateToProps和mapDispatchToProps。它们定义了 UI 组件的业务逻辑。前者负责输入逻辑，即将state映射到 UI 组件的参数（props），后者负责输出逻辑，即将用户对 UI 组件的操作映射成 Action。</p>
<blockquote>
<p>小提示: <code>connect</code>函数是一个进行了柯里化(currying)的高阶函数，currying（函数柯里化），又称部分求值。<br>一个currying的函数首先会接受一些参数，接受了这些参数之后，该函数并不会立即求值，<br>而是继续返回另外一个函数，刚才传入的参数在函数形成的闭包中被保存起来。<br>待到函数被真正需要求值的时候，之前传入的所有参数都会被一次性用于求值。</p>
</blockquote>
<h3 id="mapStateToProps"><a href="#mapStateToProps" class="headerlink" title="mapStateToProps()"></a>mapStateToProps()</h3><p>mapStateToProps是一个函数。它的作用就是像它的名字那样，建立一个从（外部的）state对象到（UI 组件的）props对象的映射关系。<br>作为函数，mapStateToProps执行后应该返回一个对象，里面的每一个键值对就是一个映射。请看下面的例子。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const mapStateToProps = (state) =&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    todos: getVisibleTodos(state.todos, state.visibilityFilter)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，mapStateToProps是一个函数，它接受state作为参数，返回一个对象。这个对象有一个todos属性，代表 UI 组件的同名参数，后面的getVisibleTodos也是一个函数，可以从state算出 todos 的值。</p>
<p>下面就是getVisibleTodos的一个例子，用来算出todos。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const getVisibleTodos = (todos, filter) =&gt; &#123;</span><br><span class="line">  switch (filter) &#123;</span><br><span class="line">    case &apos;SHOW_ALL&apos;:</span><br><span class="line">      return todos</span><br><span class="line">    case &apos;SHOW_COMPLETED&apos;:</span><br><span class="line">      return todos.filter(t =&gt; t.completed)</span><br><span class="line">    case &apos;SHOW_ACTIVE&apos;:</span><br><span class="line">      return todos.filter(t =&gt; !t.completed)</span><br><span class="line">    default:</span><br><span class="line">      throw new Error(&apos;Unknown filter: &apos; + filter)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mapStateToProps会订阅 Store，每当state更新的时候，就会自动执行，重新计算 UI 组件的参数，从而触发 UI 组件的重新渲染。</p>
<p>mapStateToProps的第一个参数总是state对象，还可以使用第二个参数，代表容器组件的props对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 容器组件的代码</span><br><span class="line">//    &lt;FilterLink filter=&quot;SHOW_ALL&quot;&gt;</span><br><span class="line">//      All</span><br><span class="line">//    &lt;/FilterLink&gt;</span><br><span class="line"></span><br><span class="line">const mapStateToProps = (state, ownProps) =&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    active: ownProps.filter === state.visibilityFilter</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用ownProps作为参数后，如果容器组件的参数发生变化，也会引发 UI 组件重新渲染。</p>
<p>connect方法可以省略mapStateToProps参数，那样的话，UI 组件就不会订阅Store，就是说 Store 的更新不会引起 UI 组件的更新。</p>
<h3 id="mapDispatchToProps"><a href="#mapDispatchToProps" class="headerlink" title="mapDispatchToProps()"></a>mapDispatchToProps()</h3><p><code>mapDispatchToProps</code>是<code>connect</code>函数的第二个参数，用来建立 UI 组件的参数到<code>store.dispatch</code>方法的映射。也就是说，它定义了哪些用户的操作应该当作 Action，传给 Store。它可以是一个函数，也可以是一个对象。</p>
<p>如果<code>mapDispatchToProps</code>是一个函数，会得到<code>dispatch</code>和<code>ownProps</code>（容器组件的<code>props</code>对象）两个参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const mapDispatchToProps = (</span><br><span class="line">  dispatch,</span><br><span class="line">  ownProps</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    onClick: () =&gt; &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: &apos;SET_VISIBILITY_FILTER&apos;,</span><br><span class="line">        filter: ownProps.filter</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面代码可以看到，<code>mapDispatchToProps</code>作为函数，应该返回一个对象，该对象的每个键值对都是一个映射，定义了 UI 组件的参数怎样发出 Action。</p>
<p>如果<code>mapDispatchToProps</code>是一个对象，它的每个键名也是对应 UI 组件的同名参数，键值应该是一个函数，会被当作 Action creator ，返回的 Action 会由 Redux 自动发出。举例来说，上面的<code>mapDispatchToProps</code>写成对象就是下面这样。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const mapDispatchToProps = &#123;</span><br><span class="line">  onClick: (filter) =&gt; &#123;</span><br><span class="line">    type: &apos;SET_VISIBILITY_FILTER&apos;,</span><br><span class="line">    filter: filter</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="lt-Provider-gt-组件"><a href="#lt-Provider-gt-组件" class="headerlink" title="&lt;Provider&gt;组件"></a>&lt;Provider&gt;组件</h2><p>connect方法生成容器组件以后，需要让容器组件拿到state对象，才能生成 UI 组件的参数。</p>
<p>一种解决方法是将state对象作为参数，传入容器组件。但是，这样做比较麻烦，尤其是容器组件可能在很深的层级，一级级将state传下去就很麻烦。</p>
<p>React-Redux 提供Provider组件，可以让容器组件拿到state。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Provider &#125; from &apos;react-redux&apos;</span><br><span class="line">import &#123; createStore &#125; from &apos;redux&apos;</span><br><span class="line">import todoApp from &apos;./reducers&apos;</span><br><span class="line">import App from &apos;./components/App&apos;</span><br><span class="line"></span><br><span class="line">let store = createStore(todoApp);</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;/Provider&gt;,</span><br><span class="line">  document.getElementById(&apos;root&apos;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，Provider在根组件外面包了一层，这样一来，App的所有子组件就默认都可以拿到state了。</p>
<p>它的原理是React组件的context属性，请看源码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Provider extends Component &#123;</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      store: this.props.store</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return this.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Provider.childContextTypes = &#123;</span><br><span class="line">  store: React.PropTypes.object</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，store放在了上下文对象context上面。然后，子组件就可以从context拿到store，代码大致如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class VisibleTodoList extends Component &#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    const &#123; store &#125; = this.context;</span><br><span class="line">    this.unsubscribe = store.subscribe(() =&gt;</span><br><span class="line">      this.forceUpdate()</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const props = this.props;</span><br><span class="line">    const &#123; store &#125; = this.context;</span><br><span class="line">    const state = store.getState();</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VisibleTodoList.contextTypes = &#123;</span><br><span class="line">  store: React.PropTypes.object</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>React-Redux自动生成的容器组件的代码，就类似上面这样，从而拿到store。</p>
<h1 id="实例-Todo-list"><a href="#实例-Todo-list" class="headerlink" title="实例: Todo list"></a>实例: Todo list</h1><p>Todo list是一个简单的待办事项管理模块。界面有三个部分组成:</p>
<ul>
<li>TodoAdd组件: 包含input输入框和添加按钮</li>
<li>TodoList组件: 显示事项列表</li>
<li>TodoFilter组件: 显示过滤条件栏</li>
</ul>
<p><img src="todo-list-marked.png" alt=""></p>
<h2 id="定义action"><a href="#定义action" class="headerlink" title="定义action"></a>定义action</h2><p>src/actions/index.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let nextTodoId = 0;</span><br><span class="line"></span><br><span class="line">export const addTodo = text =&gt; (&#123;</span><br><span class="line">  type: &apos;ADD_TODO&apos;,</span><br><span class="line">  id: nextTodoId++,</span><br><span class="line">  text</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export const toggleTodo = id =&gt; (&#123;</span><br><span class="line">  type: &apos;TOGGLE_TODO&apos;,</span><br><span class="line">  id</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>创建action creator，定义<code>ADD_TODO</code>和<code>TOGGLE_TODO</code>两个action。</p>
<h2 id="创建TodoAdd组件"><a href="#创建TodoAdd组件" class="headerlink" title="创建TodoAdd组件"></a>创建TodoAdd组件</h2><p>TodoAdd组件需要接受用户的输入，并把输入的内容加入到todo列表中，所以，TodoAdd应该是一个容器组件，可以向store发送添加TODO的事件。<br>src/containers/TodoAdd.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123; addTodo &#125; from &apos;../actions&apos;;</span><br><span class="line"></span><br><span class="line">class TodoAdd extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.todoInput;</span><br><span class="line"></span><br><span class="line">    this.onSubmit = this.onSubmit.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onSubmit(e) &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    if (!this.todoInput.value.trim()) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.props.dispatch(addTodo(this.todoInput.value));</span><br><span class="line">    this.todoInput.value = &apos;&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;form onSubmit=&#123;this.onSubmit&#125;&gt;</span><br><span class="line">          &lt;input ref=&#123;todoInput =&gt; this.todoInput = todoInput&#125; /&gt;</span><br><span class="line">          &lt;button type=&quot;submit&quot;&gt;添加代办事项&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default connect()(TodoAdd);</span><br></pre></td></tr></table></figure></p>
<p>代码说明：input中使用<code>ref</code>绑定到类中的todoInput属性上。<code>connect</code>函数会将<code>TodoAdd</code>组件转换成容器组件，并将store的dispatch函数通过props传递到<code>TodoAdd</code>组件中。</p>
<h2 id="创建TODO-reducer"><a href="#创建TODO-reducer" class="headerlink" title="创建TODO reducer"></a>创建TODO reducer</h2><p>src/reducers/todos.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const todos = (state = [], action) =&gt; &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case &apos;ADD_TODO&apos;:</span><br><span class="line">      return [</span><br><span class="line">        ...state,</span><br><span class="line">        &#123;</span><br><span class="line">          id: action.id,</span><br><span class="line">          text: action.text,</span><br><span class="line">          completed: false</span><br><span class="line">        &#125;</span><br><span class="line">      ];</span><br><span class="line">      break;</span><br><span class="line">    case &apos;TOGGLE_TODO&apos;:</span><br><span class="line">      return state.map(todo =&gt; (</span><br><span class="line">        todo.id === action.id ? &#123;...todo, completed: !todo.completed&#125; : todo</span><br><span class="line">      ));</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">      return state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default todos;</span><br></pre></td></tr></table></figure></p>
<p>todos reducer中处理<code>ADD_TODO</code>和<code>TOGGLE_TODO</code>两个action。</p>
<h2 id="创建Todo列表组件"><a href="#创建Todo列表组件" class="headerlink" title="创建Todo列表组件"></a>创建Todo列表组件</h2><h3 id="TodoList-js"><a href="#TodoList-js" class="headerlink" title="TodoList.js"></a>TodoList.js</h3><p>src/components/TodoList.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import Todo from &apos;./Todo&apos;;</span><br><span class="line"></span><br><span class="line">const TodoList = (&#123; todos, toggleTodo &#125;) =&gt; (</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;todos.map(todo =&gt;</span><br><span class="line">      &lt;Todo </span><br><span class="line">        key=&#123;todo.id&#125;</span><br><span class="line">        &#123;...todo&#125;</span><br><span class="line">        onClick=&#123;() =&gt; toggleTodo(todo.id)&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    )&#125;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default TodoList;</span><br></pre></td></tr></table></figure></p>
<p><code>TodoList</code>是一个UI组件，接受外部传入的<code>todos</code>列表，和<code>toggleTodo</code>回调，当列表中的某一项被点击时触发回调。列表本身使用ul标签。</p>
<h3 id="Todo-js"><a href="#Todo-js" class="headerlink" title="Todo.js"></a>Todo.js</h3><p>src/components/Todo.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">const Todo = (&#123; onClick, completed, text &#125;) =&gt; (</span><br><span class="line">  &lt;li </span><br><span class="line">    onClick=&#123;onClick&#125;</span><br><span class="line">    style=&#123;&#123;textDecoration: completed ? &apos;line-through&apos; : &apos;none&apos;&#125;&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &#123;text&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Todo;</span><br></pre></td></tr></table></figure></p>
<p><code>Todo.js</code>组件是对列表项<code>li</code>标签的封装，设置了基本的样式。接受completed参数，true时表明todo以完成，则用横线贯穿。</p>
<h3 id="VisibleTodoList-js"><a href="#VisibleTodoList-js" class="headerlink" title="VisibleTodoList.js"></a>VisibleTodoList.js</h3><p>src/containers/VisibleTodoList.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123; toggleTodo &#125; from &apos;../actions&apos;;</span><br><span class="line">import TodoList from &apos;../components/TodoList&apos;;</span><br><span class="line"></span><br><span class="line">const getVisibleTodos = (todos, filter) =&gt; &#123;</span><br><span class="line">  switch (filter) &#123;</span><br><span class="line">    case &apos;SHOW_ALL&apos;:</span><br><span class="line">      return todos;</span><br><span class="line">    case &apos;SHOW_COMPLETED&apos;:</span><br><span class="line">      return todos.filter(t =&gt; t.completed);</span><br><span class="line">    case &apos;SHOW_ACTIVE&apos;:</span><br><span class="line">      return todos.filter(t =&gt; !t.completed);</span><br><span class="line">    default:</span><br><span class="line">      throw new Error(&apos;Unknown filter: &apos; + filter);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const mapStateToProps = state =&gt; (&#123;</span><br><span class="line">  todos: getVisibleTodos(state.todos, state.visibilityFilter)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const mapDispatchToProps = dispatch =&gt; (&#123;</span><br><span class="line">  toggleTodo: id =&gt; dispatch(toggleTodo(id))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps, mapDispatchToProps)(TodoList);</span><br></pre></td></tr></table></figure></p>
<p><code>VisibleTodoList</code>将TodoList UI 组件转换成容器组件。</p>
<ul>
<li><code>mapStateToProps</code>函数，从<code>store</code>中取出<code>todos</code>状态，并根据当前的过滤条件选出需要显示的todo列表。<code>todos</code>对应<code>TodoList</code>组件中的props属性。</li>
<li><code>mapDispatchToProps</code>函数，定义了<code>toggleTodo</code>函数，发送<code>toggleTodo</code>事件。</li>
</ul>
<h2 id="创建Todo-Filter组件"><a href="#创建Todo-Filter组件" class="headerlink" title="创建Todo Filter组件"></a>创建Todo Filter组件</h2><h3 id="添加filter相关的action"><a href="#添加filter相关的action" class="headerlink" title="添加filter相关的action"></a>添加filter相关的action</h3><p>修改src/actions/index.js，在末尾添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export const setVisibilityFilter = filter =&gt; (&#123;</span><br><span class="line">  type: &apos;SET_VISIBILITY_FILTER&apos;,</span><br><span class="line">  filter</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export const VisibilityFilter = &#123;</span><br><span class="line">  SHOW_ALL: &apos;SHOW_ALL&apos;,</span><br><span class="line">  SHOW_COMPLETED: &apos;SHOW_COMPLETED&apos;,</span><br><span class="line">  SHOW_ACTIVE: &apos;SHOW_ACTIVE&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="创建Link组件"><a href="#创建Link组件" class="headerlink" title="创建Link组件"></a>创建Link组件</h3><p>src/components/Link.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">const Link = (&#123; active, children, onClick &#125;) =&gt; (</span><br><span class="line">  &lt;button</span><br><span class="line">    onClick=&#123;onClick&#125;</span><br><span class="line">    disabled=&#123;active&#125;</span><br><span class="line">    style=&#123;&#123;marginLeft: &apos;4px&apos;&#125;&#125;</span><br><span class="line">  &gt;</span><br><span class="line">  &#123;children&#125;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Link;</span><br></pre></td></tr></table></figure></p>
<p><code>Link</code>是一个UI组件，参数说明如下：</p>
<ul>
<li>active： 是否为激活状态。是则正常显示，否则disable掉。</li>
<li>onClick： 点击事件回调函数</li>
<li>children： button按钮的内容，可以传入任何形式，如文字或者图片等。完全由调用者决定。</li>
</ul>
<h3 id="创建FilterLink容器组件"><a href="#创建FilterLink容器组件" class="headerlink" title="创建FilterLink容器组件"></a>创建FilterLink容器组件</h3><p>src/containers/FilterLink.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123; setVisibilityFilter &#125; from &apos;../actions&apos;;</span><br><span class="line">import Link from &apos;../components/Link&apos;;</span><br><span class="line"></span><br><span class="line">const mapStateToProps = (state, ownProps) =&gt; (&#123;</span><br><span class="line">  active: ownProps.filter === state.visibilityFilter</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const mapDispatchToProps = (dispatch, ownProps) =&gt; (&#123;</span><br><span class="line">  onClick: () =&gt; dispatch(setVisibilityFilter(ownProps.filter))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps, mapDispatchToProps)(Link)</span><br></pre></td></tr></table></figure></p>
<p><code>FilterLink</code>将UI组件<code>Link</code>包装成容器组件，</p>
<ul>
<li><code>mapStateToProps</code>： 从<code>store</code>中拿到当前的<code>filter</code>类型，同时拿到自定义props中的<code>filter</code>状态，比较两个filter，相同则说明此按钮跟当前状态相匹配，则Link为激活状态。</li>
<li><code>mapDispatchToProps</code>： 设置onClick回调，发送<code>SET_VISIBILITY_FILTER</code> action。</li>
</ul>
<h3 id="创建TodoFilter组件"><a href="#创建TodoFilter组件" class="headerlink" title="创建TodoFilter组件"></a>创建TodoFilter组件</h3><p>src/components/TodoFilter.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import FilterLink from &apos;../containers/FilterLink&apos;;</span><br><span class="line">import &#123; VisibilityFilter &#125; from &apos;../actions&apos;;</span><br><span class="line"></span><br><span class="line">const TodoFilter = () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;span&gt;显示: &lt;/span&gt;</span><br><span class="line">    &lt;FilterLink filter=&#123;VisibilityFilter.SHOW_ALL&#125;&gt;全部&lt;/FilterLink&gt;</span><br><span class="line">    &lt;FilterLink filter=&#123;VisibilityFilter.SHOW_ACTIVE&#125;&gt;待办&lt;/FilterLink&gt;</span><br><span class="line">    &lt;FilterLink filter=&#123;VisibilityFilter.SHOW_COMPLETED&#125;&gt;已完成&lt;/FilterLink&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">export default TodoFilter;</span><br></pre></td></tr></table></figure></p>
<p><code>TodoFilter</code>为UI组件，组件内部包含三个<code>FilterLink</code>容器组件。</p>
<h2 id="定义App组件"><a href="#定义App组件" class="headerlink" title="定义App组件"></a>定义App组件</h2><p>src/App.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &apos;./App.css&apos;;</span><br><span class="line">import TodoAdd from &apos;./containers/TodoAdd&apos;;</span><br><span class="line">import VisibleTodoList from &apos;./containers/VisibleTodoList&apos;;</span><br><span class="line">import TodoFilter from &apos;./components/TodoFilter&apos;;</span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;TodoAdd /&gt;</span><br><span class="line">        &lt;VisibleTodoList /&gt;</span><br><span class="line">        &lt;TodoFilter /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure></p>
<p><code>App</code>组件是UI组件，为应用的根组件，包含<code>TodoAdd</code>, <code>VisibleTodoList</code>, <code>TodoFilter</code>。</p>
<h2 id="渲染App组件"><a href="#渲染App组件" class="headerlink" title="渲染App组件"></a>渲染App组件</h2><p>修改src/index.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import &apos;./index.css&apos;;</span><br><span class="line">import App from &apos;./App&apos;;</span><br><span class="line">import registerServiceWorker from &apos;./registerServiceWorker&apos;;</span><br><span class="line">import &#123; createStore &#125; from &apos;redux&apos;;</span><br><span class="line">import &#123; Provider &#125; from &apos;react-redux&apos;;</span><br><span class="line">import rootReducer from &apos;./reducers&apos;;</span><br><span class="line"></span><br><span class="line">const store = createStore(rootReducer);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt; </span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;/Provider&gt;, </span><br><span class="line">  document.getElementById(&apos;root&apos;));</span><br><span class="line">  </span><br><span class="line">registerServiceWorker();</span><br></pre></td></tr></table></figure></p>
<p>调用<code>createStore</code>创建<code>store</code>对象，同时使用<code>Provider</code>将<code>store</code>对象传递到<code>App</code>组件中。</p>
<h1 id="源码参考"><a href="#源码参考" class="headerlink" title="源码参考"></a>源码参考</h1><p>Todo list: <a href="https://github.com/jiangwalle/reudx-tutorial/tree/todolist" target="_blank" rel="noopener">https://github.com/jiangwalle/reudx-tutorial/tree/todolist</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/19/redux-tutorial-2/" data-id="cjgea579g0007sd8wrby3fjrd" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/">react</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redux/">redux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>

    </footer>
  </div>
  
    
 <script src="/jquery/jquery.min.js"></script>
  <div id="random_posts">
    <h2>推荐文章</h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>';
                if(item.excerpt){
                  html +='<div class="post-excerpt">'+item.excerpt+'</div>';
                }
                html +='</li>';
                
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
    <a href="/2018/04/21/redux-tutorial-3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          redux入门教程(三) ~ 异步action
        
      </div>
    </a>
  
  
    <a href="/2018/04/14/redux-tutorial-1/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">redux入门教程(一) ~ 基本用法</div>
    </a>
  
</nav>

  
</article>
 
     
  <div class="comments" id="comments">
    
     
       
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
       
      
      
  </div>
 
  

</section>
           
    <aside id="sidebar">
  
    

  
    
    <div class="widget-wrap">
    
      <div class="widget" id="toc-widget-fixed">
      
        <strong class="toc-title">文章目录</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#组件拆分"><span class="toc-number">1.</span> <span class="toc-text">组件拆分</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#UI组件-representational-component"><span class="toc-number">1.1.</span> <span class="toc-text">UI组件 (representational component)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器组件-container-component"><span class="toc-number">1.2.</span> <span class="toc-text">容器组件(container component)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#API函数"><span class="toc-number">2.</span> <span class="toc-text">API函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#connect"><span class="toc-number">2.1.</span> <span class="toc-text">connect()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mapStateToProps"><span class="toc-number">2.1.1.</span> <span class="toc-text">mapStateToProps()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mapDispatchToProps"><span class="toc-number">2.1.2.</span> <span class="toc-text">mapDispatchToProps()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lt-Provider-gt-组件"><span class="toc-number">2.2.</span> <span class="toc-text">&lt;Provider&gt;组件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实例-Todo-list"><span class="toc-number">3.</span> <span class="toc-text">实例: Todo list</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#定义action"><span class="toc-number">3.1.</span> <span class="toc-text">定义action</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建TodoAdd组件"><span class="toc-number">3.2.</span> <span class="toc-text">创建TodoAdd组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建TODO-reducer"><span class="toc-number">3.3.</span> <span class="toc-text">创建TODO reducer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建Todo列表组件"><span class="toc-number">3.4.</span> <span class="toc-text">创建Todo列表组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TodoList-js"><span class="toc-number">3.4.1.</span> <span class="toc-text">TodoList.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Todo-js"><span class="toc-number">3.4.2.</span> <span class="toc-text">Todo.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VisibleTodoList-js"><span class="toc-number">3.4.3.</span> <span class="toc-text">VisibleTodoList.js</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建Todo-Filter组件"><span class="toc-number">3.5.</span> <span class="toc-text">创建Todo Filter组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加filter相关的action"><span class="toc-number">3.5.1.</span> <span class="toc-text">添加filter相关的action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建Link组件"><span class="toc-number">3.5.2.</span> <span class="toc-text">创建Link组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建FilterLink容器组件"><span class="toc-number">3.5.3.</span> <span class="toc-text">创建FilterLink容器组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建TodoFilter组件"><span class="toc-number">3.5.4.</span> <span class="toc-text">创建TodoFilter组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定义App组件"><span class="toc-number">3.6.</span> <span class="toc-text">定义App组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#渲染App组件"><span class="toc-number">3.7.</span> <span class="toc-text">渲染App组件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#源码参考"><span class="toc-number">4.</span> <span class="toc-text">源码参考</span></a></li></ol>
          </div>
      </div>
    </div>

  
    

  
    
  
    
  
    

  
    
  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2018 Walle Jiang&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;jiangwalle@gmail.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>