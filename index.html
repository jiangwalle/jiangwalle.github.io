<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>WALL-E</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="技术宅的自我修养">
<meta property="og:type" content="website">
<meta property="og:title" content="WALL-E">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="WALL-E">
<meta property="og:description" content="技术宅的自我修养">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WALL-E">
<meta name="twitter:description" content="技术宅的自我修养">
  
    <link rel="alternate" href="/atom.xml" title="WALL-E" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">WALL-E</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">机器人瓦力的网络日志</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-redux-tutorial-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/19/redux-tutorial-2/" class="article-date">
  <time datetime="2018-04-19T10:18:17.000Z" itemprop="datePublished">2018-04-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/随笔/">随笔</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/19/redux-tutorial-2/">redux入门教程(二) React-Redux</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>上一篇博客中,我们介绍的redux库的基本用法，一个component要和redux交互基本分为这么几步：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">将redux的store对象通过props传入到组件中。</span><br><span class="line">组件内调用store.dispath(action)发送action到store。</span><br><span class="line">组件内调用store.subscribe(listner)向store注册监听函数，一旦state发生变化，store会调用listner函数。</span><br><span class="line">listner中调用store.getState，并从中取出相关联的state信息，然后调用render重新渲染组件。</span><br></pre></td></tr></table></figure></p>
<p>这里有几个问题：</p>
<ul>
<li>每一个包含state的组件都需要传入store对象，调用store的API来发送action和注册监听函数，比较繁琐。</li>
<li>store.getState拿到的是整个state树，还要从中找到跟组件相关的状态信息。</li>
<li>没有规则说明哪些component去和redux进行交互，如果每一个要，那么组件就会跟redux产生依赖，不利于重用，测试也更复杂。<br><img src="sleepy-puppy.gif" alt=""></li>
</ul>
<p>因此，redux的作者分装了一个React专用的库<a href="https://github.com/reactjs/react-redux" target="_blank" rel="noopener">React-Redux</a>以方便在React中使用Redux。它主要有如下两个特性：</p>
<ul>
<li>自动将component注册到store，并将store中的state转换成props传入到组件中。</li>
<li>定义了组件拆分的规范，将组件划分为容器组件和UI组件。</li>
</ul>
<p>当然使用工具库是一把双刃剑，在便利的同时，也引入了更多的约束。同时，个人觉得React-Redux的API在设计上对初学者不是很友好。使react的学习曲线更加曲折。</p>
<h1 id="组件拆分"><a href="#组件拆分" class="headerlink" title="组件拆分"></a>组件拆分</h1><p>组件拆分的规范是React-Redux的特点之一，它将组件分为两大类容器组件(container component)和UI组件(presentational component)。</p>
<h2 id="UI组件-representational-component"><a href="#UI组件-representational-component" class="headerlink" title="UI组件 (representational component)"></a>UI组件 (representational component)</h2><p>UI组件有如下特征：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">只负责 UI 的呈现，不带有任何业务逻辑</span><br><span class="line">没有状态（即不使用this.state这个变量）</span><br><span class="line">所有数据都由参数（this.props）提供</span><br><span class="line">不使用任何 Redux 的 API</span><br><span class="line">高可复用性</span><br></pre></td></tr></table></figure></p>
<p>下面是一个UI组件的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const Popup = props =&gt; </span><br><span class="line">	&lt;p&gt;&#123;props.text&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure></p>
<p>UI组件的参数全部来源于外部props的输入，所以，像纯函数一样，完全由参数来觉得组件呈现的状态。</p>
<h2 id="容器组件-container-component"><a href="#容器组件-container-component" class="headerlink" title="容器组件(container component)"></a>容器组件(container component)</h2><p>容器组件的特征恰恰相反。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">负责管理数据和业务逻辑，不负责 UI 的呈现</span><br><span class="line">带有内部状态</span><br><span class="line">使用 Redux 的 API</span><br><span class="line">与Redux耦合，不具有复用性</span><br></pre></td></tr></table></figure></p>
<p>简而言之，跟UI呈现相关联的放到UI组件中，以提高复用性，跟数据管理和逻辑相关的，放到容器组件中。一般来说，我们会根据页面来划分组件，一个页面可以创建一个相应的容器组件，在容器组件中组合多个UI组件。</p>
<h1 id="API函数"><a href="#API函数" class="headerlink" title="API函数"></a>API函数</h1><h2 id="connect"><a href="#connect" class="headerlink" title="connect()"></a>connect()</h2><p>React-Redux提供<code>connect</code>函数，用来将组件连接到Redux的Store。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;</span><br><span class="line">const VisibleTodoList = connect()(TodoList);</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，TodoList是 UI 组件，VisibleTodoList就是由 React-Redux 通过connect方法自动生成的容器组件。<br>但是，因为没有定义业务逻辑，上面这个容器组件毫无意义，只是 UI 组件的一个单纯的包装层。为了定义业务逻辑，需要给出下面两方面的信息。</p>
<ul>
<li>输入逻辑：外部的数据（即state对象）如何转换为 UI 组件的参数</li>
<li>输出逻辑：用户发出的动作如何变为 Action 对象，从 UI 组件传出去。</li>
</ul>
<p>因此，connect方法的完整 API 如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;</span><br><span class="line"></span><br><span class="line">const VisibleTodoList = connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(TodoList)</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，connect方法接受两个参数：mapStateToProps和mapDispatchToProps。它们定义了 UI 组件的业务逻辑。前者负责输入逻辑，即将state映射到 UI 组件的参数（props），后者负责输出逻辑，即将用户对 UI 组件的操作映射成 Action。</p>
<blockquote>
<p>小提示: <code>connect</code>函数是一个进行了柯里化(currying)的高阶函数，currying（函数柯里化），又称部分求值。<br>一个currying的函数首先会接受一些参数，接受了这些参数之后，该函数并不会立即求值，<br>而是继续返回另外一个函数，刚才传入的参数在函数形成的闭包中被保存起来。<br>待到函数被真正需要求值的时候，之前传入的所有参数都会被一次性用于求值。</p>
</blockquote>
<h3 id="mapStateToProps"><a href="#mapStateToProps" class="headerlink" title="mapStateToProps()"></a>mapStateToProps()</h3><p>mapStateToProps是一个函数。它的作用就是像它的名字那样，建立一个从（外部的）state对象到（UI 组件的）props对象的映射关系。<br>作为函数，mapStateToProps执行后应该返回一个对象，里面的每一个键值对就是一个映射。请看下面的例子。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const mapStateToProps = (state) =&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    todos: getVisibleTodos(state.todos, state.visibilityFilter)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，mapStateToProps是一个函数，它接受state作为参数，返回一个对象。这个对象有一个todos属性，代表 UI 组件的同名参数，后面的getVisibleTodos也是一个函数，可以从state算出 todos 的值。</p>
<p>下面就是getVisibleTodos的一个例子，用来算出todos。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const getVisibleTodos = (todos, filter) =&gt; &#123;</span><br><span class="line">  switch (filter) &#123;</span><br><span class="line">    case &apos;SHOW_ALL&apos;:</span><br><span class="line">      return todos</span><br><span class="line">    case &apos;SHOW_COMPLETED&apos;:</span><br><span class="line">      return todos.filter(t =&gt; t.completed)</span><br><span class="line">    case &apos;SHOW_ACTIVE&apos;:</span><br><span class="line">      return todos.filter(t =&gt; !t.completed)</span><br><span class="line">    default:</span><br><span class="line">      throw new Error(&apos;Unknown filter: &apos; + filter)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mapStateToProps会订阅 Store，每当state更新的时候，就会自动执行，重新计算 UI 组件的参数，从而触发 UI 组件的重新渲染。</p>
<p>mapStateToProps的第一个参数总是state对象，还可以使用第二个参数，代表容器组件的props对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 容器组件的代码</span><br><span class="line">//    &lt;FilterLink filter=&quot;SHOW_ALL&quot;&gt;</span><br><span class="line">//      All</span><br><span class="line">//    &lt;/FilterLink&gt;</span><br><span class="line"></span><br><span class="line">const mapStateToProps = (state, ownProps) =&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    active: ownProps.filter === state.visibilityFilter</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用ownProps作为参数后，如果容器组件的参数发生变化，也会引发 UI 组件重新渲染。</p>
<p>connect方法可以省略mapStateToProps参数，那样的话，UI 组件就不会订阅Store，就是说 Store 的更新不会引起 UI 组件的更新。</p>
<h3 id="mapDispatchToProps"><a href="#mapDispatchToProps" class="headerlink" title="mapDispatchToProps()"></a>mapDispatchToProps()</h3><p><code>mapDispatchToProps</code>是<code>connect</code>函数的第二个参数，用来建立 UI 组件的参数到<code>store.dispatch</code>方法的映射。也就是说，它定义了哪些用户的操作应该当作 Action，传给 Store。它可以是一个函数，也可以是一个对象。</p>
<p>如果<code>mapDispatchToProps</code>是一个函数，会得到<code>dispatch</code>和<code>ownProps</code>（容器组件的<code>props</code>对象）两个参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const mapDispatchToProps = (</span><br><span class="line">  dispatch,</span><br><span class="line">  ownProps</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    onClick: () =&gt; &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: &apos;SET_VISIBILITY_FILTER&apos;,</span><br><span class="line">        filter: ownProps.filter</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面代码可以看到，<code>mapDispatchToProps</code>作为函数，应该返回一个对象，该对象的每个键值对都是一个映射，定义了 UI 组件的参数怎样发出 Action。</p>
<p>如果<code>mapDispatchToProps</code>是一个对象，它的每个键名也是对应 UI 组件的同名参数，键值应该是一个函数，会被当作 Action creator ，返回的 Action 会由 Redux 自动发出。举例来说，上面的<code>mapDispatchToProps</code>写成对象就是下面这样。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const mapDispatchToProps = &#123;</span><br><span class="line">  onClick: (filter) =&gt; &#123;</span><br><span class="line">    type: &apos;SET_VISIBILITY_FILTER&apos;,</span><br><span class="line">    filter: filter</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="lt-Provider-gt-组件"><a href="#lt-Provider-gt-组件" class="headerlink" title="&lt;Provider&gt;组件"></a>&lt;Provider&gt;组件</h2><p>connect方法生成容器组件以后，需要让容器组件拿到state对象，才能生成 UI 组件的参数。</p>
<p>一种解决方法是将state对象作为参数，传入容器组件。但是，这样做比较麻烦，尤其是容器组件可能在很深的层级，一级级将state传下去就很麻烦。</p>
<p>React-Redux 提供Provider组件，可以让容器组件拿到state。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Provider &#125; from &apos;react-redux&apos;</span><br><span class="line">import &#123; createStore &#125; from &apos;redux&apos;</span><br><span class="line">import todoApp from &apos;./reducers&apos;</span><br><span class="line">import App from &apos;./components/App&apos;</span><br><span class="line"></span><br><span class="line">let store = createStore(todoApp);</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;/Provider&gt;,</span><br><span class="line">  document.getElementById(&apos;root&apos;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，Provider在根组件外面包了一层，这样一来，App的所有子组件就默认都可以拿到state了。</p>
<p>它的原理是React组件的context属性，请看源码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Provider extends Component &#123;</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      store: this.props.store</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return this.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Provider.childContextTypes = &#123;</span><br><span class="line">  store: React.PropTypes.object</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，store放在了上下文对象context上面。然后，子组件就可以从context拿到store，代码大致如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class VisibleTodoList extends Component &#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    const &#123; store &#125; = this.context;</span><br><span class="line">    this.unsubscribe = store.subscribe(() =&gt;</span><br><span class="line">      this.forceUpdate()</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const props = this.props;</span><br><span class="line">    const &#123; store &#125; = this.context;</span><br><span class="line">    const state = store.getState();</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VisibleTodoList.contextTypes = &#123;</span><br><span class="line">  store: React.PropTypes.object</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>React-Redux自动生成的容器组件的代码，就类似上面这样，从而拿到store。</p>
<h1 id="实例-Todo-list"><a href="#实例-Todo-list" class="headerlink" title="实例: Todo list"></a>实例: Todo list</h1><p>Todo list是一个简单的待办事项管理模块。界面有三个部分组成:</p>
<ul>
<li>TodoAdd组件: 包含input输入框和添加按钮</li>
<li>TodoList组件: 显示事项列表</li>
<li>TodoFilter组件: 显示过滤条件栏</li>
</ul>
<p><img src="todo-list-marked.png" alt=""></p>
<h2 id="定义action"><a href="#定义action" class="headerlink" title="定义action"></a>定义action</h2><p>src/actions/index.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let nextTodoId = 0;</span><br><span class="line"></span><br><span class="line">export const addTodo = text =&gt; (&#123;</span><br><span class="line">  type: &apos;ADD_TODO&apos;,</span><br><span class="line">  id: nextTodoId++,</span><br><span class="line">  text</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export const toggleTodo = id =&gt; (&#123;</span><br><span class="line">  type: &apos;TOGGLE_TODO&apos;,</span><br><span class="line">  id</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>创建action creator，定义<code>ADD_TODO</code>和<code>TOGGLE_TODO</code>两个action。</p>
<h2 id="创建TodoAdd组件"><a href="#创建TodoAdd组件" class="headerlink" title="创建TodoAdd组件"></a>创建TodoAdd组件</h2><p>TodoAdd组件需要接受用户的输入，并把输入的内容加入到todo列表中，所以，TodoAdd应该是一个容器组件，可以向store发送添加TODO的事件。<br>src/containers/TodoAdd.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123; addTodo &#125; from &apos;../actions&apos;;</span><br><span class="line"></span><br><span class="line">class TodoAdd extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.todoInput;</span><br><span class="line"></span><br><span class="line">    this.onSubmit = this.onSubmit.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onSubmit(e) &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    if (!this.todoInput.value.trim()) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.props.dispatch(addTodo(this.todoInput.value));</span><br><span class="line">    this.todoInput.value = &apos;&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;form onSubmit=&#123;this.onSubmit&#125;&gt;</span><br><span class="line">          &lt;input ref=&#123;todoInput =&gt; this.todoInput = todoInput&#125; /&gt;</span><br><span class="line">          &lt;button type=&quot;submit&quot;&gt;添加代办事项&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default connect()(TodoAdd);</span><br></pre></td></tr></table></figure></p>
<p>代码说明：input中使用<code>ref</code>绑定到类中的todoInput属性上。<code>connect</code>函数会将<code>TodoAdd</code>组件转换成容器组件，并将store的dispatch函数通过props传递到<code>TodoAdd</code>组件中。</p>
<h2 id="创建TODO-reducer"><a href="#创建TODO-reducer" class="headerlink" title="创建TODO reducer"></a>创建TODO reducer</h2><p>src/reducers/todos.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const todos = (state = [], action) =&gt; &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case &apos;ADD_TODO&apos;:</span><br><span class="line">      return [</span><br><span class="line">        ...state,</span><br><span class="line">        &#123;</span><br><span class="line">          id: action.id,</span><br><span class="line">          text: action.text,</span><br><span class="line">          completed: false</span><br><span class="line">        &#125;</span><br><span class="line">      ];</span><br><span class="line">      break;</span><br><span class="line">    case &apos;TOGGLE_TODO&apos;:</span><br><span class="line">      return state.map(todo =&gt; (</span><br><span class="line">        todo.id === action.id ? &#123;...todo, completed: !todo.completed&#125; : todo</span><br><span class="line">      ));</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">      return state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default todos;</span><br></pre></td></tr></table></figure></p>
<p>todos reducer中处理<code>ADD_TODO</code>和<code>TOGGLE_TODO</code>两个action。</p>
<h2 id="创建Todo列表组件"><a href="#创建Todo列表组件" class="headerlink" title="创建Todo列表组件"></a>创建Todo列表组件</h2><h3 id="TodoList-js"><a href="#TodoList-js" class="headerlink" title="TodoList.js"></a>TodoList.js</h3><p>src/components/TodoList.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import Todo from &apos;./Todo&apos;;</span><br><span class="line"></span><br><span class="line">const TodoList = (&#123; todos, toggleTodo &#125;) =&gt; (</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;todos.map(todo =&gt;</span><br><span class="line">      &lt;Todo </span><br><span class="line">        key=&#123;todo.id&#125;</span><br><span class="line">        &#123;...todo&#125;</span><br><span class="line">        onClick=&#123;() =&gt; toggleTodo(todo.id)&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    )&#125;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default TodoList;</span><br></pre></td></tr></table></figure></p>
<p><code>TodoList</code>是一个UI组件，接受外部传入的<code>todos</code>列表，和<code>toggleTodo</code>回调，当列表中的某一项被点击时触发回调。列表本身使用ul标签。</p>
<h3 id="Todo-js"><a href="#Todo-js" class="headerlink" title="Todo.js"></a>Todo.js</h3><p>src/components/Todo.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">const Todo = (&#123; onClick, completed, text &#125;) =&gt; (</span><br><span class="line">  &lt;li </span><br><span class="line">    onClick=&#123;onClick&#125;</span><br><span class="line">    style=&#123;&#123;textDecoration: completed ? &apos;line-through&apos; : &apos;none&apos;&#125;&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &#123;text&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Todo;</span><br></pre></td></tr></table></figure></p>
<p><code>Todo.js</code>组件是对列表项<code>li</code>标签的封装，设置了基本的样式。接受completed参数，true时表明todo以完成，则用横线贯穿。</p>
<h3 id="VisibleTodoList-js"><a href="#VisibleTodoList-js" class="headerlink" title="VisibleTodoList.js"></a>VisibleTodoList.js</h3><p>src/containers/VisibleTodoList.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123; toggleTodo &#125; from &apos;../actions&apos;;</span><br><span class="line">import TodoList from &apos;../components/TodoList&apos;;</span><br><span class="line"></span><br><span class="line">const getVisibleTodos = (todos, filter) =&gt; &#123;</span><br><span class="line">  switch (filter) &#123;</span><br><span class="line">    case &apos;SHOW_ALL&apos;:</span><br><span class="line">      return todos;</span><br><span class="line">    case &apos;SHOW_COMPLETED&apos;:</span><br><span class="line">      return todos.filter(t =&gt; t.completed);</span><br><span class="line">    case &apos;SHOW_ACTIVE&apos;:</span><br><span class="line">      return todos.filter(t =&gt; !t.completed);</span><br><span class="line">    default:</span><br><span class="line">      throw new Error(&apos;Unknown filter: &apos; + filter);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const mapStateToProps = state =&gt; (&#123;</span><br><span class="line">  todos: getVisibleTodos(state.todos, state.visibilityFilter)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const mapDispatchToProps = dispatch =&gt; (&#123;</span><br><span class="line">  toggleTodo: id =&gt; dispatch(toggleTodo(id))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps, mapDispatchToProps)(TodoList);</span><br></pre></td></tr></table></figure></p>
<p><code>VisibleTodoList</code>将TodoList UI 组件转换成容器组件。</p>
<ul>
<li><code>mapStateToProps</code>函数，从<code>store</code>中取出<code>todos</code>状态，并根据当前的过滤条件选出需要显示的todo列表。<code>todos</code>对应<code>TodoList</code>组件中的props属性。</li>
<li><code>mapDispatchToProps</code>函数，定义了<code>toggleTodo</code>函数，发送<code>toggleTodo</code>事件。</li>
</ul>
<h2 id="创建Todo-Filter组件"><a href="#创建Todo-Filter组件" class="headerlink" title="创建Todo Filter组件"></a>创建Todo Filter组件</h2><h3 id="添加filter相关的action"><a href="#添加filter相关的action" class="headerlink" title="添加filter相关的action"></a>添加filter相关的action</h3><p>修改src/actions/index.js，在末尾添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export const setVisibilityFilter = filter =&gt; (&#123;</span><br><span class="line">  type: &apos;SET_VISIBILITY_FILTER&apos;,</span><br><span class="line">  filter</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export const VisibilityFilter = &#123;</span><br><span class="line">  SHOW_ALL: &apos;SHOW_ALL&apos;,</span><br><span class="line">  SHOW_COMPLETED: &apos;SHOW_COMPLETED&apos;,</span><br><span class="line">  SHOW_ACTIVE: &apos;SHOW_ACTIVE&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="创建Link组件"><a href="#创建Link组件" class="headerlink" title="创建Link组件"></a>创建Link组件</h3><p>src/components/Link.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">const Link = (&#123; active, children, onClick &#125;) =&gt; (</span><br><span class="line">  &lt;button</span><br><span class="line">    onClick=&#123;onClick&#125;</span><br><span class="line">    disabled=&#123;active&#125;</span><br><span class="line">    style=&#123;&#123;marginLeft: &apos;4px&apos;&#125;&#125;</span><br><span class="line">  &gt;</span><br><span class="line">  &#123;children&#125;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Link;</span><br></pre></td></tr></table></figure></p>
<p><code>Link</code>是一个UI组件，参数说明如下：</p>
<ul>
<li>active： 是否为激活状态。是则正常显示，否则disable掉。</li>
<li>onClick： 点击事件回调函数</li>
<li>children： button按钮的内容，可以传入任何形式，如文字或者图片等。完全由调用者决定。</li>
</ul>
<h3 id="创建FilterLink容器组件"><a href="#创建FilterLink容器组件" class="headerlink" title="创建FilterLink容器组件"></a>创建FilterLink容器组件</h3><p>src/containers/FilterLink.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123; setVisibilityFilter &#125; from &apos;../actions&apos;;</span><br><span class="line">import Link from &apos;../components/Link&apos;;</span><br><span class="line"></span><br><span class="line">const mapStateToProps = (state, ownProps) =&gt; (&#123;</span><br><span class="line">  active: ownProps.filter === state.visibilityFilter</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const mapDispatchToProps = (dispatch, ownProps) =&gt; (&#123;</span><br><span class="line">  onClick: () =&gt; dispatch(setVisibilityFilter(ownProps.filter))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps, mapDispatchToProps)(Link)</span><br></pre></td></tr></table></figure></p>
<p><code>FilterLink</code>将UI组件<code>Link</code>包装成容器组件，</p>
<ul>
<li><code>mapStateToProps</code>： 从<code>store</code>中拿到当前的<code>filter</code>类型，同时拿到自定义props中的<code>filter</code>状态，比较两个filter，相同则说明此按钮跟当前状态相匹配，则Link为激活状态。</li>
<li><code>mapDispatchToProps</code>： 设置onClick回调，发送<code>SET_VISIBILITY_FILTER</code> action。</li>
</ul>
<h3 id="创建TodoFilter组件"><a href="#创建TodoFilter组件" class="headerlink" title="创建TodoFilter组件"></a>创建TodoFilter组件</h3><p>src/components/TodoFilter.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import FilterLink from &apos;../containers/FilterLink&apos;;</span><br><span class="line">import &#123; VisibilityFilter &#125; from &apos;../actions&apos;;</span><br><span class="line"></span><br><span class="line">const TodoFilter = () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;span&gt;显示: &lt;/span&gt;</span><br><span class="line">    &lt;FilterLink filter=&#123;VisibilityFilter.SHOW_ALL&#125;&gt;全部&lt;/FilterLink&gt;</span><br><span class="line">    &lt;FilterLink filter=&#123;VisibilityFilter.SHOW_ACTIVE&#125;&gt;待办&lt;/FilterLink&gt;</span><br><span class="line">    &lt;FilterLink filter=&#123;VisibilityFilter.SHOW_COMPLETED&#125;&gt;已完成&lt;/FilterLink&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">export default TodoFilter;</span><br></pre></td></tr></table></figure></p>
<p><code>TodoFilter</code>为UI组件，组件内部包含三个<code>FilterLink</code>容器组件。</p>
<h2 id="定义App组件"><a href="#定义App组件" class="headerlink" title="定义App组件"></a>定义App组件</h2><p>src/App.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &apos;./App.css&apos;;</span><br><span class="line">import TodoAdd from &apos;./containers/TodoAdd&apos;;</span><br><span class="line">import VisibleTodoList from &apos;./containers/VisibleTodoList&apos;;</span><br><span class="line">import TodoFilter from &apos;./components/TodoFilter&apos;;</span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;TodoAdd /&gt;</span><br><span class="line">        &lt;VisibleTodoList /&gt;</span><br><span class="line">        &lt;TodoFilter /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure></p>
<p><code>App</code>组件是UI组件，为应用的根组件，包含<code>TodoAdd</code>, <code>VisibleTodoList</code>, <code>TodoFilter</code>。</p>
<h2 id="渲染App组件"><a href="#渲染App组件" class="headerlink" title="渲染App组件"></a>渲染App组件</h2><p>修改src/index.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import &apos;./index.css&apos;;</span><br><span class="line">import App from &apos;./App&apos;;</span><br><span class="line">import registerServiceWorker from &apos;./registerServiceWorker&apos;;</span><br><span class="line">import &#123; createStore &#125; from &apos;redux&apos;;</span><br><span class="line">import &#123; Provider &#125; from &apos;react-redux&apos;;</span><br><span class="line">import rootReducer from &apos;./reducers&apos;;</span><br><span class="line"></span><br><span class="line">const store = createStore(rootReducer);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt; </span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;/Provider&gt;, </span><br><span class="line">  document.getElementById(&apos;root&apos;));</span><br><span class="line">  </span><br><span class="line">registerServiceWorker();</span><br></pre></td></tr></table></figure></p>
<p>调用<code>createStore</code>创建<code>store</code>对象，同时使用<code>Provider</code>将<code>store</code>对象传递到<code>App</code>组件中。</p>
<h1 id="源码参考"><a href="#源码参考" class="headerlink" title="源码参考"></a>源码参考</h1><p>Todo list: <a href="https://github.com/jiangwalle/reudx-tutorial/tree/todolist" target="_blank" rel="noopener">https://github.com/jiangwalle/reudx-tutorial/tree/todolist</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/19/redux-tutorial-2/" data-id="cjg8k8dix0002fu8we42qp7vl" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/">react</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redux/">redux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-redux-tutorial-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/14/redux-tutorial-1/" class="article-date">
  <time datetime="2018-04-14T00:30:54.000Z" itemprop="datePublished">2018-04-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/随笔/">随笔</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/14/redux-tutorial-1/">redux入门教程(一) 基本用法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在React应用中，我们通常会把页面拆分成一个个尽可能小的组件，组件的功能越细化、纯粹，可复用性就越高。然而，在实现页面的交互逻辑是，经常会需要涉及到多个组件之间的交互。常见的组件通信方式有：</p>
<ul>
<li>通过context api来存放需要共享的数据。</li>
<li>使用回调函数在共同的祖先里进行数据交换。</li>
</ul>
<h2 id="回调函数实例"><a href="#回调函数实例" class="headerlink" title="回调函数实例"></a>回调函数实例</h2><p>考虑这样一个案例，一个页面中有两个组件构成，<code>&lt;Header /&gt;</code>组件为页面的头部，<code>&lt;Theme /&gt;</code>组件有几个按钮，可以设置<code>&lt;Header /&gt;</code>组件的背景颜色。<br>src/components/Header.js：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export default class Header extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;header className=&quot;App-header&quot; style=&#123;&#123;backgroundColor: this.props.bgColor&#125;&#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码说明：<code>Header</code>组件通过props接收外部传入的背景颜色(bgColor)。</p>
<p>src/components/Theme.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export default class Theme extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  changeColor = (color) =&gt; &#123;</span><br><span class="line">    this.props.onColorChange(color);  </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div style=&#123;&#123;margin: &apos;20px&apos;&#125;&#125;&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.changeColor.bind(this, &apos;blue&apos;)&#125;&gt;blue&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.changeColor.bind(this, &apos;pink&apos;)&#125;&gt;pink&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.changeColor.bind(this, &apos;red&apos;)&#125;&gt;red&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.changeColor.bind(this, &apos;black&apos;)&#125;&gt;black&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码说明：<code>Theme</code>组件接收一个回调函数，当按钮被点击时，触发回调函数，将颜色值触底到parent组件中，在此例中为<code>App</code>组件。</p>
<p>src/App.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &apos;./App.css&apos;;</span><br><span class="line">import Header from &apos;./components/Header&apos;;</span><br><span class="line">import Theme from &apos;./components/Theme&apos;;</span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      &apos;bgColor&apos;: &apos;&apos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.onColorChange = this.onColorChange.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onColorChange(color) &#123;</span><br><span class="line">    this.setState(&#123;&apos;bgColor&apos;: color&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;Header bgColor=&#123;this.state.bgColor&#125; /&gt;</span><br><span class="line">        &lt;Theme onColorChange=&#123;this.onColorChange&#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure></p>
<p>代码说明：<code>App</code>组件传递回调函数到<code>Theme</code>组件，当<code>Theme</code>中的按钮点击后，触发回调函数，然后<code>App</code>再将拿到的颜色值通过props传递到<code>Header</code>组件中，以此完成从<code>Theme</code>组件到<code>Header</code>组件的通信。</p>
<h2 id="困难"><a href="#困难" class="headerlink" title="困难"></a>困难</h2><p>此例中<code>Header</code>组件和<code>Theme</code>组件相邻，只需要通过<code>App</code>组件传递回调函数即可。但是当系统非常大时，很有可能<code>Header</code>和<code>Theme</code>相距甚远。那么就需要在很多的上级组件之间传递回调函数。非常麻烦。<br>为了解决这个问题，2014年，facebook提出flux的概念。Redux就是基于这种思想的一种实现方式。redux库已经成为react工具家族中不可或缺的一部分。</p>
<h1 id="redux设计思想"><a href="#redux设计思想" class="headerlink" title="redux设计思想"></a>redux设计思想</h1><p>redux的设计思想归纳起来有两点：</p>
<ul>
<li>web应用是一个状态机，视图和状态一一对应。</li>
<li>所有的状态(state)，保存在一个对象里。</li>
</ul>
<p>如何来理解这两句话呢？举个小例子。在上大学的时候，冬天，很冷。很多人就会逃课，卧床不起。中午就想让班里去上课的同学带点饭回来。一般来说，需要一个个去联系熟悉的同学。有时候，联系的人不在或者没法带，就得继续联系其他人。尤其是其他寝室的同学，联系起来比较不便。为了解决这个问题，出现了一个雷锋同学，他游走于各个寝室，统计大家需要带的饭，然后把订单交给帮忙带饭的同学，当饭被带回来后，他在跑回各个寝室把饭发给大家。这里的雷锋模式就是redux思想的实现，每个需要带饭的人都是一个组件，组件之间不再需要相互交互，当带饭的同学买到饭后，不用知道要交给谁，交给雷锋就行了。由雷锋进行统一派送即可。而每一个需要买饭的同学，也只要跟雷锋进行沟通即可。</p>
<h1 id="redux核心概念"><a href="#redux核心概念" class="headerlink" title="redux核心概念"></a>redux核心概念</h1><h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><p>Store就是存放数据的地方，在react应用中，只有一个store，它存储了所有的state。在上例中，store就是雷锋。<br>redux库中提供<code>createStore</code>函数来生成store实例.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from &apos;redux&apos;;</span><br><span class="line">const store = createStore(fn);</span><br></pre></td></tr></table></figure></p>
<h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><p>State就是组件的状态信息。对应上例，饭就是组件的状态。store中包含所有的state信息。可以通过<code>store.getState()</code>拿到当前的状态信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from &apos;redux&apos;;</span><br><span class="line">const store = createStore(fn);</span><br><span class="line"></span><br><span class="line">const state = store.getState();</span><br></pre></td></tr></table></figure></p>
<h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><p>redux规定，不允许直接修改store中的state信息。如果要修改，有且只有一种方式，就是向store发送一个action，action的格式为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const action = &#123;</span><br><span class="line">  type: &apos;buy_food&apos;,</span><br><span class="line">  payload: &apos;bread&apos;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>action一般由view触发，例如，选择面包商品后，点击购买按钮。就会发送一个购买的action。</p>
<h2 id="Action-Creator"><a href="#Action-Creator" class="headerlink" title="Action Creator"></a>Action Creator</h2><p>在复杂的应用中，action会非常多，每一次去构造action对象会比较麻烦，所以，可以创建一个工具方法，来生成action。这个工具方法就是Action Creator。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const BUY_FOOD = &apos;buy_food&apos;;</span><br><span class="line"></span><br><span class="line">function buyFood(foodName) &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    type: BUY_FOOD,</span><br><span class="line">    foodName</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const action = buyFood(&apos;bread&apos;);</span><br></pre></td></tr></table></figure></p>
<h2 id="store-dispatch"><a href="#store-dispatch" class="headerlink" title="store.dispatch()"></a>store.dispatch()</h2><p>store.dispatch()是view发送action的唯一方式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from &apos;redux&apos;;</span><br><span class="line">const store = createStore(fn);</span><br><span class="line"></span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: &apos;ADD_TODO&apos;,</span><br><span class="line">  payload: &apos;Learn Redux&apos;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>结合Action Creator:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.dispatch(addTodo(&apos;Learn Redux&apos;));</span><br></pre></td></tr></table></figure></p>
<h2 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h2><p>store收到action之后，必须要计算出一个新的state，然后通知view，这样view才会发生变化。这个state的计算过程就叫reducer。<br>reducer是一个函数，它接收action和当前的state作为参数，返回一个新的state。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const reducer = function (state, action) &#123;</span><br><span class="line">  // ...</span><br><span class="line">  return new_state;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>在实际应用中，当组件调用<code>store.dispatch</code>函数向store发送一个action命令后，会自动触发reducer执行。所以，store需要知道reducer函数。做法就是在创建store时，将reducerc还如<code>createStore</code>方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from &apos;redux&apos;;</span><br><span class="line">const store = createStore(reducer);</span><br></pre></td></tr></table></figure></p>
<h2 id="纯函数"><a href="#纯函数" class="headerlink" title="纯函数"></a>纯函数</h2><p>Reducer 函数最重要的特征是，它是一个纯函数。也就是说，只要是同样的输入，必定得到同样的输出。<br>纯函数是函数式编程的概念，必须遵守以下一些约束。</p>
<ul>
<li>不得改写参数</li>
<li>不能调用系统 I/O 的API</li>
<li>不能调用Date.now()或者Math.random()等不纯的方法，因为每次会得到不一样的结果</li>
</ul>
<p>由于 Reducer 是纯函数，就可以保证同样的State，必定得到同样的 View。但也正因为这一点，Reducer 函数里面不能改变 State，必须返回一个全新的对象，请参考下面的写法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// State 是一个对象</span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">  return Object.assign(&#123;&#125;, state, &#123; thingToChange &#125;);</span><br><span class="line">  // 或者</span><br><span class="line">  return &#123; ...state, ...newState &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// State 是一个数组</span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">  return [...state, newItem];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最好把 State 对象设成只读。你没法改变它，要得到新的 State，唯一办法就是生成一个新对象。这样的好处是，任何时候，与某个 View 对应的 State 总是一个不变的对象。</p>
<h2 id="store-subscribe"><a href="#store-subscribe" class="headerlink" title="store.subscribe()"></a>store.subscribe()</h2><p>Store 允许使用<code>store.subscribe</code>方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from &apos;redux&apos;;</span><br><span class="line">const store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">store.subscribe(listener);</span><br></pre></td></tr></table></figure></p>
<p>显然，只要把 View 的更新函数（对于 React 项目，就是组件的render方法或setState方法）放入listen，就会实现 View 的自动渲染。<br>store.subscribe方法返回一个函数，调用这个函数就可以解除监听。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let unsubscribe = store.subscribe(() =&gt;</span><br><span class="line">  console.log(store.getState())</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">unsubscribe();</span><br></pre></td></tr></table></figure></p>
<h1 id="Reducer的拆分"><a href="#Reducer的拆分" class="headerlink" title="Reducer的拆分"></a>Reducer的拆分</h1><p>Reducer函数负责生成state。由于整个react应用只有一个State对象，包含所有数据，对于大型应用，这个State必然非常庞大，导致reducer也非常庞大。<br>例如如下的reducer：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const appReducer = (state = defaultState, action = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  const &#123; type, payload &#125; = action;</span><br><span class="line">  switch (type) &#123;</span><br><span class="line">    case ADD_ORDER:</span><br><span class="line">      return Object.assign(&#123;&#125;, state, &#123;</span><br><span class="line">        orders: state.orders.concat(payload)</span><br><span class="line">      &#125;);</span><br><span class="line">    case DELETE_ORDER:</span><br><span class="line">      return Object.assign(&#123;&#125;, state, &#123;</span><br><span class="line">        orders: state.orders.filter(order =&gt; order !== payload)</span><br><span class="line">      &#125;);</span><br><span class="line">    case CHANGE_PASSWORD:</span><br><span class="line">      return Object.assign(&#123;&#125;, state, &#123;</span><br><span class="line">        password: payload</span><br><span class="line">      &#125;);</span><br><span class="line">    case CHANGE_EMAIL:</span><br><span class="line">      return Object.assign(&#123;&#125;, state, &#123;</span><br><span class="line">        email: payload</span><br><span class="line">      &#125;);</span><br><span class="line">    default: return state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>上面的三种action，分别修改了state的两种属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ADD_ORDER: orders属性，添加一个新order</span><br><span class="line">DELETE_ORDER: orders属性，移除一个order</span><br><span class="line">CHANGE_PASSWORD: password属性，修改password</span><br><span class="line">CHANGE_EMAIL: email属性，修改email</span><br></pre></td></tr></table></figure></p>
<p>一般来说，orders属性和password属性分别属于不同的页面，前者是订单管理页面，后者是个人信息管理页面。因此，我们可以将整个reducer拆分为两个，一方面方便管理，另一方面，拆分出来的reducer与页面相对应，从而增加了可读性。</p>
<p>orderReducer.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const orderReducer = (state = defaultState, action = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  const &#123; type, payload &#125; = action;</span><br><span class="line">  switch (type) &#123;</span><br><span class="line">    case ADD_ORDER:</span><br><span class="line">      return Object.assign(&#123;&#125;, state, &#123;</span><br><span class="line">        orders: state.orders.concat(payload)</span><br><span class="line">      &#125;);</span><br><span class="line">    case DELETE_ORDER:</span><br><span class="line">      return Object.assign(&#123;&#125;, state, &#123;</span><br><span class="line">        orders: state.orders.filter(order =&gt; order !== payload)</span><br><span class="line">      &#125;);</span><br><span class="line">    default: return state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>userReducer.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const userReducer = (state = defaultState, action = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  const &#123; type, payload &#125; = action;</span><br><span class="line">  switch (type) &#123;</span><br><span class="line">    case CHANGE_PASSWORD:</span><br><span class="line">      return Object.assign(&#123;&#125;, state, &#123;</span><br><span class="line">        password: payload</span><br><span class="line">      &#125;);</span><br><span class="line">    case CHANGE_EMAIL:</span><br><span class="line">      return Object.assign(&#123;&#125;, state, &#123;</span><br><span class="line">        email: payload</span><br><span class="line">      &#125;);</span><br><span class="line">    default: return state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>redux中提供一个<code>combineReducers</code>方法，用于将所有的子reducer合并成一个。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const rootReducer = combineReducers(&#123;</span><br><span class="line">  orderReducer: orderReducer,</span><br><span class="line">  userReducer: userReducer</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>代码中属性名称和reducer名称相同，可简化为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const rootReducer = combineReducers(&#123;</span><br><span class="line">  orderReducer,</span><br><span class="line">  userReducer</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h1 id="Redux执行流程"><a href="#Redux执行流程" class="headerlink" title="Redux执行流程"></a>Redux执行流程</h1><p><img src="redux-flow.jpg" alt=""><br>首先view发出action<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.dispatch(action)</span><br></pre></td></tr></table></figure></p>
<p>然后，Store会自动调用Reducer，并且传入两个参数，当前的State和s收到的Action。Reducer计算并返回新的State。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let newState = counterReducer(currentState, action);</span><br></pre></td></tr></table></figure></p>
<p>State一旦发生变化，Store就会调用监听函数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 设置监听函数</span><br><span class="line">store.subscribe(listener);</span><br></pre></td></tr></table></figure></p>
<p><code>listener</code>可以通过<code>store.getState()</code>得到当前的状态。从而重新渲染view。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function listerner() &#123;</span><br><span class="line">  let newState = store.getState();</span><br><span class="line">  component.setState(newState);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="counter实例"><a href="#counter实例" class="headerlink" title="counter实例"></a>counter实例</h1><p>一个redux版本的简单计数器。</p>
<p>安装redux库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add redux</span><br></pre></td></tr></table></figure></p>
<p>src/components/Counter.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export default class Counter extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      count: &apos;&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    this.store = props.store;</span><br><span class="line">    this.getCountFromStore = this.getCountFromStore.bind(this);</span><br><span class="line">    this.render = this.render.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.store.subscribe(this.getCountFromStore);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getCountFromStore() &#123;</span><br><span class="line">    this.setState(&#123;&apos;count&apos;: this.store.getState()&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const value = this.store.getState();</span><br><span class="line">    return(</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">          Clicked: &#123;value&#125; times</span><br><span class="line">          &lt;button onClick=&#123;() =&gt; this.store.dispatch(&#123;type: &apos;INCREMENT&apos;&#125;)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">          &lt;button onClick=&#123;() =&gt; this.store.dispatch(&#123;type: &apos;DECREMENT&apos;&#125;)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码说明：<code>Counter</code>组件接收store参数，点击按钮时，通过<code>store.dispath</code>向store中发送action。同时，在<code>componentDidMount</code>时，向store注册<code>getCountFromStore</code>回调函数，当state发生变化时，从store中拿到当前的count值，并渲染出来。</p>
<p>src/reducers/counter.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export default (state = 0, action) =&gt; &#123;</span><br><span class="line">  switch(action.type) &#123;</span><br><span class="line">    case &apos;INCREMENT&apos;:</span><br><span class="line">      return state + 1;</span><br><span class="line">    case &apos;DECREMENT&apos;:</span><br><span class="line">      return state - 1;</span><br><span class="line">    default:</span><br><span class="line">      return state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>src/index.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import &#123; createStore &#125; from &apos;redux&apos;;</span><br><span class="line">import counter from &apos;./reducers/counter&apos;;</span><br><span class="line">import Counter from &apos;./components/Counter&apos;;</span><br><span class="line"></span><br><span class="line">const store = createStore(counter);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;Counter store=&#123;store&#125; /&gt;, document.getElementById(&apos;root&apos;));</span><br></pre></td></tr></table></figure></p>
<p>代码说明：使用<code>createStore</code>初始化store实例，然后传入到<code>Counter</code>组件中使用。</p>
<h1 id="源代码请参考："><a href="#源代码请参考：" class="headerlink" title="源代码请参考："></a>源代码请参考：</h1><p>回调函数实例 <a href="https://github.com/jiangwalle/reudx-tutorial/tree/component-communication" target="_blank" rel="noopener">https://github.com/jiangwalle/reudx-tutorial/tree/component-communication</a><br>counter实例 <a href="https://github.com/jiangwalle/reudx-tutorial/tree/counter" target="_blank" rel="noopener">https://github.com/jiangwalle/reudx-tutorial/tree/counter</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/14/redux-tutorial-1/" data-id="cjg8k8dit0000fu8wr9kc5plg" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/">react</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redux/">redux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-react-router-playground" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/10/react-router-playground/" class="article-date">
  <time datetime="2018-04-09T20:09:24.000Z" itemprop="datePublished">2018-04-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/随笔/">随笔</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/10/react-router-playground/">react-router基础教程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>在web应用中，通常会根据功能划分多个页面。例如在浏览器中打开<a href="https://jiangwalle.github.com" target="_blank" rel="noopener">https://jiangwalle.github.com</a>可以进入到博客的首页，输入<a href="https://jiangwalle.github.com/categories/随笔" target="_blank" rel="noopener">https://jiangwalle.github.com/categories/随笔</a>就会跳转到随笔分类中。</p>
<p>react-router是一个开源的react库，可以帮助我们在react应用中实现页面跳转。</p>
<p>下面我们通过一个简单的应用来学习react-router的常见用法。本教程使用creat-react-app搭建开发环境，react-router版本为4.2.2。</p>
<p>源码地址：<a href="https://github.com/jiangwalle/react-router-playground" target="_blank" rel="noopener">https://github.com/jiangwalle/react-router-playground</a></p>
<h2 id="应用介绍"><a href="#应用介绍" class="headerlink" title="应用介绍"></a>应用介绍</h2><p>此应用为movie检索应用，包括movie列表页，movie详情页，登录页，以及个人信息页。</p>
<h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><p>安装creact-react-app，并初始化工程。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -g creact-react-app</span><br><span class="line">creat-react-app react-router-playground</span><br></pre></td></tr></table></figure></p>
<p>安装react-router库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd react-router-playground</span><br><span class="line">yarn add react-router-dom</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure></p>
<p>此时应该可以在浏览器中看到react应用。默认地址是<a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a></p>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><h3 id="BrowserRouter-Route-Link"><a href="#BrowserRouter-Route-Link" class="headerlink" title="BrowserRouter, Route, Link"></a>BrowserRouter, Route, Link</h3><p>在src目录下新建目录routes,并创建电影列表页Movies.js，登录页Login.js。<br>Login.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export default class Login extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;Login page&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Movies.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export default class Movies extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;Movies page&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改src目录下的App.js为如下代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; BrowserRouter, Route, Link &#125; from &apos;react-router-dom&apos;;</span><br><span class="line">import Movies from &apos;./routes/Movies&apos;;</span><br><span class="line">import Login from &apos;./routes/Login&apos;;</span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;Link to=&apos;/&apos;&gt;Movies&lt;/Link&gt;</span><br><span class="line">          &lt;Link to=&apos;/login&apos;&gt;Login&lt;/Link&gt;</span><br><span class="line"></span><br><span class="line">          &lt;Route exact path=&apos;/&apos; component=&#123;Movies&#125; /&gt;</span><br><span class="line">          &lt;Route path=&apos;/login&apos; component=&#123;Login&#125; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure></p>
<p>打开<a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a>可以看到<img src="1.png" alt=""><br>代码说明：<br><code>&lt;BrowserRouter&gt;</code>：为路由容器组件，使用react-router管理的组件都应该放到此组件之下。<br><code>&lt;Route&gt;</code>：为路由组件，用于定义路由和组件(页面)对应关系。<br><code>&lt;Link&gt;</code>：导航组件，用来触发路由的跳转。</p>
<h3 id="完善电影列表页和登录页"><a href="#完善电影列表页和登录页" class="headerlink" title="完善电影列表页和登录页"></a>完善电影列表页和登录页</h3><p>修改Movies.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import blackp from &apos;../assets/blackp.jpg&apos;;</span><br><span class="line">import earlyman from &apos;../assets/earlyman.jpg&apos;;</span><br><span class="line">import baaghi from &apos;../assets/baaghi.jpg&apos;;</span><br><span class="line">import &apos;../index.css&apos;;</span><br><span class="line"></span><br><span class="line">export default class Movies extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    const movies = [</span><br><span class="line">      &#123;&apos;id&apos;: 1, &apos;name&apos;: &apos;黑豹&apos;, &apos;pic&apos;: blackp, &apos;desc&apos;: &apos;激情动作片&apos;&#125;,</span><br><span class="line">      &#123;&apos;id&apos;: 2, &apos;name&apos;: &apos;Early Man&apos;, &apos;pic&apos;: earlyman, &apos;desc&apos;: &apos;动画片&apos;&#125;,</span><br><span class="line">      &#123;&apos;id&apos;: 3, &apos;name&apos;: &apos;BAAGHI2&apos;, &apos;pic&apos;: baaghi, &apos;desc&apos;: &apos;胸很大&apos;&#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&apos;container&apos;&gt;</span><br><span class="line">        &#123; movies.map(movie =&gt; &lt;Card &#123;...movie&#125; /&gt;) &#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Card = (&#123;pic, name, desc&#125;) =&gt; (</span><br><span class="line">  &lt;div className=&apos;card&apos;&gt;</span><br><span class="line">    &lt;img src=&#123;pic&#125; style=&#123;&#123;width: &apos;100%&apos;&#125;&#125; /&gt;</span><br><span class="line">    &lt;div className=&apos;content&apos;&gt;</span><br><span class="line">      &lt;h4&gt;&lt;b&gt;&#123;name&#125;&lt;/b&gt;&lt;/h4&gt;</span><br><span class="line">      &lt;p&gt;&#123;desc&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>修改index.css文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">.container &#123;</span><br><span class="line">  margin: 50px auto;</span><br><span class="line">  width: 1024px;</span><br><span class="line">  overflow: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card &#123;</span><br><span class="line">  width: 300px;</span><br><span class="line">  margin: 10px 20px;</span><br><span class="line">  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);</span><br><span class="line">  transition: 0.3s;</span><br><span class="line">  float: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card:hover &#123;</span><br><span class="line">  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.content &#123;</span><br><span class="line">  padding: 2px 16px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.center &#123;</span><br><span class="line">  text-align: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改Login.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export default class Login extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      username: &apos;&apos;,</span><br><span class="line">      password: &apos;&apos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.onSubmit = this.onSubmit.bind(this);</span><br><span class="line">    this.onFormChange = this.onFormChange.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onFormChange(e) &#123;</span><br><span class="line">    this.setState(&#123;[e.target.name]: e.target.value&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onSubmit() &#123;</span><br><span class="line">    alert(`$&#123;this.state.username&#125; $&#123;this.state.password&#125;`);</span><br><span class="line">    localStorage.setItem(&apos;user&apos;, this.state);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&apos;container center&apos;&gt;</span><br><span class="line">        &lt;h4&gt;登录页面&lt;/h4&gt;</span><br><span class="line">        &lt;form&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;input name=&apos;username&apos; onChange=&#123;this.onFormChange&#125; placeholder=&apos;用户名&apos;&gt;&lt;/input&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;input name=&apos;password&apos; onChange=&#123;this.onFormChange&#125; type=&apos;password&apos; placeholder=&apos;密码&apos;&gt;&lt;/input&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;button onClick=&#123;this.onSubmit&#125;&gt;登录&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>效果如下：<br><img src="movies.png" alt=""><br><img src="login.png" alt=""></p>
<h2 id="给Link组件添加样式"><a href="#给Link组件添加样式" class="headerlink" title="给Link组件添加样式"></a>给Link组件添加样式</h2><p><code>&lt;Link&gt;</code>组件本质上来说就是一个a标签，我们可以直接在Link组件上设置样式。<br>修改index.css，在末尾添加如下代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.header &#123;</span><br><span class="line">  background-color: #3e3b49;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-item &#123;</span><br><span class="line">  color: #f2f2f2;</span><br><span class="line">  text-decoration: none;</span><br><span class="line">  font-size: 20px;</span><br><span class="line">  text-align: center;</span><br><span class="line">  padding: 14px 26px;</span><br><span class="line">  display: inline-block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改App.js，BrowserRouter部分为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;BrowserRouter&gt;</span><br><span class="line">  &lt;div&gt; </span><br><span class="line">    &lt;div className=&apos;header&apos;&gt;</span><br><span class="line">      &lt;Link className=&apos;nav-item&apos; to=&apos;/&apos;&gt;Movies&lt;/Link&gt;</span><br><span class="line">      &lt;Link className=&apos;nav-item&apos; to=&apos;/login&apos;&gt;Login&lt;/Link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Route exact path=&apos;/&apos; component=&#123;Movies&#125; /&gt;</span><br><span class="line">    &lt;Route path=&apos;/login&apos; component=&#123;Login&#125; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/BrowserRouter&gt;</span><br></pre></td></tr></table></figure></p>
<p>效果如下：<img src="header.png" alt=""></p>
<h2 id="URL传参"><a href="#URL传参" class="headerlink" title="URL传参"></a>URL传参</h2><p>很多时候，我们会需要在url中传递参数信息，例如，在movies列表页，点击某一个movie卡片，进入到movie详情页。<br>要实现此功能，我们需要在跳转的url链接中传递参数来实现，例如传递movie的id。这样movie详情页就可以根据movie的id向后台查询movie的详情并展示出来。</p>
<p>添加Movie.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export default class Movies extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; match &#125; = this.props;</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&apos;container&apos;&gt;Movie detail &#123;match.params.id&#125;&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改Movies.js文件里的Card组件，在图片标签外增加Link组件，点击图片时跳转到movie详情页。Card组件代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const Card = (&#123;pic, name, desc, id&#125;) =&gt; (</span><br><span class="line">  &lt;div className=&apos;card&apos;&gt;</span><br><span class="line">    &lt;Link to=&#123;`/movie/$&#123;id&#125;`&#125;&gt;&lt;img src=&#123;pic&#125; style=&#123;&#123;width: &apos;100%&apos;&#125;&#125; /&gt;&lt;/Link&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;div className=&apos;content&apos;&gt;</span><br><span class="line">      &lt;h4&gt;&lt;b&gt;&#123;name&#125;&lt;/b&gt;&lt;/h4&gt;</span><br><span class="line">      &lt;p&gt;&#123;desc&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>修改App.js文件，导入Movie.js组件，并设置movie详情页路由.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 在第4行后添加</span><br><span class="line">import Movie from &apos;./routes/Movie&apos;;</span><br><span class="line">...</span><br><span class="line">// 在第18行后添加</span><br><span class="line">&lt;Route path=&apos;/movie/:id&apos; component=&#123;Movie&#125;/&gt;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><img src="movie.png" alt=""><br>代码说明：<br><code>&lt;Route path=&#39;/movie/:id&#39; component={Movie}/&gt;</code>，此处的<code>:id</code>可以匹配任意字符串，如/movie/123, /movie/hello。<br>在Movie组件中，可以从props参数里，拿到react-router传递的id参数。如123，hello。</p>
<h2 id="受限路由"><a href="#受限路由" class="headerlink" title="受限路由"></a>受限路由</h2><p>在web应用中经常会出现有些页面被限制访问，比如订单页面，只有登录之后才可以查看等。在react-router中，我们可以封装一个PrivateRouter组件，<br>在组件内部判断，如果用户已登录则加载相关组件，否则使用<code>&lt;Redirect&gt;</code>组件重定向到登录页面去。</p>
<p>创建Profile.js页面，此页面只有在登录后才可以查看。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export default class Profile extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div class=&apos;container&apos;&gt;</span><br><span class="line">        &lt;p&gt;姓名: 仓老师&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;身高：160cm&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;三维：80 30 80&lt;/p&gt;`</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改Login.js页面，当用户点击登录时，存储用户信息到localstorage，并显示退出按钮。点击退出时，清空localstorage的用户信息，并显示登录框。<br>具体代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export default class Login extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      username: &apos;&apos;,</span><br><span class="line">      password: &apos;&apos;,</span><br><span class="line">      isLoggedin: false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.login = this.login.bind(this);</span><br><span class="line">    this.onFormChange = this.onFormChange.bind(this);</span><br><span class="line">    this.logout = this.logout.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onFormChange(e) &#123;</span><br><span class="line">    this.setState(&#123;[e.target.name]: e.target.value&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  login() &#123;</span><br><span class="line">    localStorage.setItem(&apos;user&apos;, this.state);</span><br><span class="line">    this.setState(&#123;&apos;isLoggedin&apos;: true&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  logout() &#123;</span><br><span class="line">    localStorage.removeItem(&apos;user&apos;);</span><br><span class="line">    this.setState(&#123;&apos;isLoggedin&apos;: false&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    if (localStorage.getItem(&apos;user&apos;) !== null ) &#123;</span><br><span class="line">      this.setState(&#123;&apos;isLoggedin&apos;: true&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&apos;container center&apos;&gt;</span><br><span class="line">        &lt;h4&gt;登录页面&lt;/h4&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          this.state.isLoggedin</span><br><span class="line">          ? &lt;button onClick=&#123;this.logout&#125;&gt;退出&lt;/button&gt; </span><br><span class="line">          : &lt;form&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;input name=&apos;username&apos; onChange=&#123;this.onFormChange&#125; placeholder=&apos;用户名&apos;&gt;&lt;/input&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;input name=&apos;password&apos; onChange=&#123;this.onFormChange&#125; type=&apos;password&apos; placeholder=&apos;密码&apos;&gt;&lt;/input&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;button onClick=&#123;this.login&#125;&gt;登录&lt;/button&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在src目录下创建AuthRoute.js组件。该组件接收真正需要显示的界面组件，内部会判断当前用户是否已登录(及查看localstorage中是否有user对象)，<br>找到则显示传入的界面组件，否者跳转到登录页面。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125;from &apos;react&apos;;</span><br><span class="line">import &#123; Route, Redirect &#125; from &apos;react-router-dom&apos;;</span><br><span class="line"></span><br><span class="line">export default class AuthRoute extends Component &#123;</span><br><span class="line">  isLoggedin() &#123;</span><br><span class="line">    const user = localStorage.getItem(&apos;user&apos;);</span><br><span class="line">    return user !== null;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123;component: Component, ...rest&#125; = this.props;</span><br><span class="line">    return (</span><br><span class="line">        &lt;Route</span><br><span class="line">          &#123;...rest&#125;</span><br><span class="line">          render=&#123; props =&gt;  this.isLoggedin()</span><br><span class="line">            ? ( &lt;Component &#123;...props&#125; /&gt; )</span><br><span class="line">            : ( &lt;Redirect to=&#123;&#123;pathname: &apos;/login&apos;, state: &#123;from: props.location&#125;&#125;&#125; /&gt; )</span><br><span class="line">          &#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码说明：<br>Route中的<code>render</code>函数接收一个function对象，可以直接渲染传入的组件。<br><code>&lt;Redirect&gt;</code>为重定向组件，可以重新将路由跳转到其他的路径。</p>
<p>OK，完事具备，接下来在App.js中添加Profile页面，验证逻辑是否正确。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 在第6行下添加</span><br><span class="line">import AuthRoute from &apos;./AuthRoute&apos;;</span><br><span class="line"></span><br><span class="line">// 在16行下添加</span><br><span class="line">&lt;Link className=&apos;nav-item&apos; to=&apos;/profile&apos;&gt;Profile&lt;/Link&gt;</span><br><span class="line"></span><br><span class="line">// 在22行下添加</span><br><span class="line">&lt;AuthRoute path=&apos;/profile&apos; component=&#123;Profile&#125;/&gt;</span><br></pre></td></tr></table></figure></p>
<p>运行效果：<br><img src="profile.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/10/react-router-playground/" data-id="cjg8k8dj40008fu8wo9j8zez3" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/">react</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react-router/">react-router</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-markdown" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/17/markdown/" class="article-date">
  <time datetime="2018-02-16T22:48:03.000Z" itemprop="datePublished">2018-02-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/随笔/">随笔</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/17/markdown/">markdown基本语法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>Markdown是一种电子邮件风格的标记语言。其优点有：</p>
<ul>
<li>纯文本，所以兼容性极强，可以用所有文本编辑器打开。</li>
<li>让你专注于文字而不是排版。</li>
<li>格式转换方便，Markdown 的文本你可以轻松转换为 html、电子书等。</li>
<li>Markdown 的标记语法有极好的可读性。</li>
</ul>
<h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 一级标题</span><br><span class="line">## 二级标题</span><br><span class="line">### 三级标题</span><br><span class="line">#### 四级标题</span><br><span class="line">##### 五级标题</span><br><span class="line">###### 六级标题</span><br></pre></td></tr></table></figure>
<p>注：# 和「一级标题」之间建议保留一个字符的空格，这是最标准的 Markdown 写法。</p>
<p>显示效果：<br><img src="markdown-title.jpg" alt=""></p>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><h3 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- 文本1</span><br><span class="line">- 文本2</span><br><span class="line">- 文本3</span><br></pre></td></tr></table></figure>
<p>显示效果：</p>
<ul>
<li>文本1</li>
<li>文本2</li>
<li>文本3</li>
</ul>
<h3 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 文本1</span><br><span class="line">2. 文本2</span><br><span class="line">3. 文本3</span><br></pre></td></tr></table></figure>
<p>显示效果：</p>
<ol>
<li>文本1</li>
<li>文本2</li>
<li>文本3</li>
</ol>
<p>注：-、1.和文本之间要保留一个字符的空格。</p>
<h2 id="文字链接"><a href="#文字链接" class="headerlink" title="文字链接"></a>文字链接</h2><p>在 Markdown 中，插入链接不需要其他按钮，你只需要使用 <code>[显示文本](链接地址)</code> 这样的语法即可，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[谷歌](http://www.google.com)</span><br></pre></td></tr></table></figure></p>
<p>显示效果：<br><a href="http://www.google.com" target="_blank" rel="noopener">谷歌</a></p>
<h2 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h2><p>在 Markdown 中，插入图片不需要其他按钮，你只需要使用 <code>![](图片链接地址)</code> 这样的语法即可，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](http://www.dogsirhome.com/wp-content/uploads/2017/06/beepress-image-432-1496386376-2.jpeg)</span><br></pre></td></tr></table></figure></p>
<p>显示效果：<br><img src="http://www.dogsirhome.com/wp-content/uploads/2017/06/beepress-image-432-1496386376-2.jpeg" alt=""></p>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>在我们写作的时候经常需要引用他人的文字，这个时候引用这个格式就很有必要了，在 Markdown 中，你只需要在你希望引用的文字前面加上 <code>&gt;</code> 就好了，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; 三毛《梦里花落知多少》：即使不成功，也不至于空白。</span><br></pre></td></tr></table></figure></p>
<p>显示效果：</p>
<blockquote>
<p>三毛《梦里花落知多少》：即使不成功，也不至于空白。</p>
</blockquote>
<h2 id="粗体和斜体"><a href="#粗体和斜体" class="headerlink" title="粗体和斜体"></a>粗体和斜体</h2><p>Markdown 的粗体和斜体也非常简单，用两个<code>**</code>包含一段文本就是粗体的语法，用一个<code>*</code>包含一段文本就是斜体的语法。例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">三毛《梦里花落知多少》：即使不*成功*，也不至于**空白**。</span><br></pre></td></tr></table></figure></p>
<p>显示效果(成功是斜体，空白是粗体):<br>三毛《梦里花落知多少》：即使不<em>成功</em>，也不至于<strong>空白</strong>。</p>
<h2 id="代码引用"><a href="#代码引用" class="headerlink" title="代码引用"></a>代码引用</h2><p>需要引用代码时，如果引用的语句只有一段，不分行，可以用 ` 将语句包起来。<br>如果引用的语句为多行，可以将```置于这段代码的首行和末行。<br>显示效果：<br><img src="markdown-code.jpg" alt=""></p>
<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><p>表格效果在博客中是经常出现的。<br>示例代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|dog | bird | cat|</span><br><span class="line">|----|------|----|</span><br><span class="line">|foo | foo  | foo|</span><br><span class="line">|bar | bar  | bar|</span><br><span class="line">|baz | baz  | baz|</span><br></pre></td></tr></table></figure></p>
<p>显示效果<br><img src="markdown-table.png" alt=""></p>
<h2 id="字符转义"><a href="#字符转义" class="headerlink" title="字符转义"></a>字符转义</h2><p>有时候我们需要在页面里打印markdown里的功能字符，例如：<code>*</code>, <code>(</code>等。此时，我们使用<code>\</code>来对字符进行转义。<br>示例代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">输出：</span><br><span class="line">\*</span><br><span class="line">\(</span><br><span class="line">\)</span><br><span class="line">\[</span><br><span class="line">\]</span><br><span class="line">\+</span><br><span class="line">\-</span><br></pre></td></tr></table></figure></p>
<p>*<br>(<br>)<br>[<br>]<br>+<br>-</p>
<h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><ul>
<li><a href="http://xianbai.me/learn-md/article/syntax/blackslash-escapes.html" target="_blank" rel="noopener">http://xianbai.me/learn-md/article/syntax/blackslash-escapes.html</a></li>
<li><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet" target="_blank" rel="noopener">https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/02/17/markdown/" data-id="cjg8k8dj20007fu8wjdehf6fm" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/markdown/">markdown</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-hexo-setup-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/17/hexo-setup-1/" class="article-date">
  <time datetime="2018-02-16T22:43:43.000Z" itemprop="datePublished">2018-02-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/随笔/">随笔</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/17/hexo-setup-1/">使用hexo+github搭建博客(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="搭建步骤"><a href="#搭建步骤" class="headerlink" title="搭建步骤"></a>搭建步骤</h1><ul>
<li>创建github pages</li>
<li>搭建hexo</li>
</ul>
<h2 id="github-pages规则"><a href="#github-pages规则" class="headerlink" title="github pages规则"></a>github pages规则</h2><ul>
<li>仓库名称和用户名名称一致</li>
</ul>
<h2 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h2><h2 id="安装GIT"><a href="#安装GIT" class="headerlink" title="安装GIT"></a>安装GIT</h2><h1 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h1><h2 id="初始化hexo工程"><a href="#初始化hexo工程" class="headerlink" title="初始化hexo工程"></a>初始化hexo工程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init yourname</span><br><span class="line">cd yourname</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>
<p>其中<code>yourname</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/02/17/hexo-setup-1/" data-id="cjg8k8dj10006fu8wl50vvmsk" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li></ul>

    </footer>
  </div>
  
</article>
 


  

</section>
           
    <aside id="sidebar">
  
    
  <div class="widget-wrap">
     
        <h3 class="follow-title ">Follow me</h3>
     
    <div class="widget follow">
      
              <a class="github" aria-hidden="true" href="https://github.com/jiangwalle" target="_blank" title="Github"></a>
      
      
      
      
            <a class="email" aria-hidden="true"  href="mailto:jiangwalle@gmail.com" target="_blank" title="邮箱"></a>
      
    </div>
  </div>


  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title categories">分类</h3>
    <div class="widget" id="categories">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title tagcloud">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/blog/" style="font-size: 14px;">blog</a> <a href="/tags/hexo/" style="font-size: 14px;">hexo</a> <a href="/tags/markdown/" style="font-size: 14px;">markdown</a> <a href="/tags/react/" style="font-size: 25px;">react</a> <a href="/tags/react-router/" style="font-size: 14px;">react-router</a> <a href="/tags/redux/" style="font-size: 19.5px;">redux</a> <a href="/tags/tutorial/" style="font-size: 25px;">tutorial</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/19/redux-tutorial-2/">redux入门教程(二) React-Redux</a>
          </li>
        
          <li>
            <a href="/2018/04/14/redux-tutorial-1/">redux入门教程(一) 基本用法</a>
          </li>
        
          <li>
            <a href="/2018/04/10/react-router-playground/">react-router基础教程</a>
          </li>
        
          <li>
            <a href="/2018/02/17/markdown/">markdown基本语法</a>
          </li>
        
          <li>
            <a href="/2018/02/17/hexo-setup-1/">使用hexo+github搭建博客(一)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title archive">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
    
<div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
        <ul>
            
            <li>
                <a href="http://www.oncewalk.com">oncewalk</a>
            </li>
            
            <li>
                <a href="http://tearstory.com">tearstory</a>
            </li>
            
            <li>
                <a href="http://www.itburn.com">itburn</a>
            </li>
            
        </ul>
    </div>
</div>

  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2018 Walle Jiang&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;jiangwalle@gmail.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>